# 包构建手册

## 目录

* 什么是包
* 包的组成
  - 资源文件
  - 脚本文件
* 如何打包
  - Windows
  - Linux
* 脚本
  - 多语言支持
  - 多脚本联合执行
  - 脚本函数简介与参数解析
    * install
    * config
    * check
    * remove
* 脚本建议
* 包依赖与冲突文件
  - dependency
  - reverseConflict
  - conflict
* bpm内部实现说明

## 什么是包

如果你用过Linux，那么大概率会了解到包管理器，如apt，yum之类的。包管理器管理的就是包。同样的bpm管理的也是包，只不过它管理的是ballance的包，并且提供了一些普通包管理器没有的选项来专门为ballance服务。

如果你对上面所述并不熟悉，那么打个比方，bpm是一个家电服务商，你可以通过它为你的家（ballance）安装各种电器（包），而且这个家电服务商很智能，能了解你家可以带动多大的电器并及时调整电器之间的关系（包冲突与依赖管理）

## 包的组成

对于bpm所管理的包，主要由两部分组成，**资源文件**与**安装脚本**。资源文件与安装脚本整合并打包成一个zip文件之后，便成为bpm可以识别的包了。

### 资源文件

资源文件是当前包需要为游戏配置的内容，对于map类型的包来说，这个文件就是地图nmo文件，对于ballance mod loader来说，这个文件就是游戏核心修改文件以及各类配置文件。

### 脚本文件

脚本文件是bpm包的核心文件。因为bpm会在安装，配置，检测，删除包的时候调用脚本文件，提供必要的参数，并由脚本文件自行做一些操作，来使得包被正确安装。**bpm是不会管理资源文件的，一切对资源文件的操作都由脚本文件代为执行**，同时这也赋予了包制作者极大的权利。bpm无法管控这些，所以请各位包制作者参考后面的脚本建议来编写bpm包，以达到统一的效果。

## 如何打包

如果你使用Windows（这或许是大多数人的情况），请选中你需要安装的文件，然后右键选择发送到-Zip压缩包即可。

如果你并不使用Windows，或者并不想用Windows自带的压缩，请手动以zip格式创建压缩包，不要添加任何多余选项，以防止解包失败。

Tips：请至少确保安装脚本被单独置于zip包下，而不是zip包中某个文件夹下，否则bpm会找不到安装脚本而报错。例如：正确示例：`xxx.zip/setup.py` 错误示例：`xxx.zip/xxxFolder/setup.py`

## 安装脚本

前面已经大致说过，安装脚本将会在必要的时刻被调用，以方便处理包中的资源文件。

bpm脚本支持多语言，但就目前来说，只支持Python脚本。

bpm支持多脚本协同运行，脚本文件的名称需要遵守这个命名规范：`setup-N.xxx` 其中xxx是你脚本的后缀名，如果是Python就是py，如果是lua脚本就是lua。而N指的是脚本的执行顺序，是一个从1开始取的正整数，如果你只需要一个脚本文件，那么直接命名成`setup-1.xxx`即可。但如果你需要多个脚本顺序执行，那么其余脚本的文件名，只需将1改为2，3。。。等即可，bpm会按照数字的顺序依次执行脚本中的语句。



### Python安装脚本

Python安装脚本共有4个函数，分别是install，check，deploy，remove。分别对应安装，检测完整性，部署，移除。

通用参数`game_path`和`current_path`分别代表游戏目录与当前脚本的执行目录（存放有相关资源文件）

由于设计上的智障，目前来说，`game_path`的最后一位是带slash的，而`current_path`是不带slash的，以后版本或许会加以改进，但是在project-javelin之前的版本都是此种类型的参数

大部分返回类型的标明已在脚本示例文件中写出，这里不做过多描述。这里只说一下部署的含义。bpm支持多种类型的包，有mod这种可以直接部署在游戏里的包，也有map这种需要让玩家自行决定安装到何处的包，部署正式给玩家这种选择。对于map这种需要部署的包，在安装的时候不应去修改游戏关卡文件，而应当在部署的时候，将自身携带的资源文件覆盖到游戏文件上。
